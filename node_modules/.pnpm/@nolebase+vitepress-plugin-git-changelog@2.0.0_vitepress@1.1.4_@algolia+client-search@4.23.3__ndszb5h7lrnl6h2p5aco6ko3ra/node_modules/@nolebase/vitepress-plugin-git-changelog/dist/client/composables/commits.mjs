import { computed, ref, toValue } from "vue";
import Changelog from "virtual:nolebase-git-changelog";
export function useCommits(pageData) {
  const gitChangelog = ref(Changelog);
  if (!gitChangelog.value)
    gitChangelog.value = { commits: [] };
  return {
    commits: computed(() => {
      const currentPath = toValue(pageData.value.filePath);
      const preCommits = gitChangelog.value.commits;
      const commits = preCommits.filter((c) => c.path === currentPath) || [];
      return commits.filter((commit, index) => {
        if (commit.tag && (!commits[index + 1] || commits[index + 1]?.tag))
          return false;
        return true;
      });
    }),
    update(data) {
      gitChangelog.value = { commits: data };
    }
  };
}
